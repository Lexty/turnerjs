// Generated by desperado 
/** @class wysiwyg.editor.commandregistrars.QuickActionsCommandRegistrar */
define.experiment.newClass('wysiwyg.editor.commandregistrars.QuickActionsCommandRegistrar.QuickACtions', function (def, strategy) {

    def.binds(['_onOpenPageTransitions']);

    def.resources(['W.Commands', 'W.CommandsNew', 'W.Resources', 'W.Config', 'W.EditorDialogs', 'W.Preview', 'W.Utils']);

    def.fields({
        _providers: [],
        _providerRegistrationCallback: null
    });

    def.methods({
        initialize:function () {
            this.resource.getResourceValue("W.Editor", function(editorManager) {
                this.resources.W.Editor = editorManager;
            }.bind(this));
        },

        registerCommands:function () {
            var cmdmgr = this.resources.W.Commands;

            //cmdmgr.registerCommandAndListener("QuickActionsCommand.OpenMediaFrame", this, this._openMediaFrame);
            cmdmgr.registerCommandAndListener("QuickActionsCommand.DeleteCurrentPage", this, this._deleteCurrentPage);
            cmdmgr.registerCommandAndListener("QuickActionsCommand.OpenManageStore", this, this._openManageStore);
            cmdmgr.registerCommandAndListener("QuickActionsCommand.OpenManageBlog", this, this._openManageBlog);
//            cmdmgr.registerCommandAndListener("QuickActionsCommand.OpenCMS", this, this._openCMS);
            cmdmgr.registerCommandAndListener("QuickActionsCommand.SearchHelpDialog", this, this._searchHelpDialog);

            // Settings Side Panel Shortcuts
            cmdmgr.registerCommandAndListener("QuickActionsCommand.ShowSiteName", this, this._onShowSiteName);
            cmdmgr.registerCommandAndListener("QuickActionsCommand.ShowFaviconAndThumbnail", this, this._onShowFaviconAndThumbnail);
            cmdmgr.registerCommandAndListener("QuickActionsCommand.ShowSocial", this, this._onShowSocial);
            cmdmgr.registerCommandAndListener("QuickActionsCommand.ShowSEO", this, this._onShowSeo);
            cmdmgr.registerCommandAndListener("QuickActionsCommand.ShowStatistics", this, this._onShowStatistics);

            // Pages Side Panel Shortcuts
            cmdmgr.registerCommandAndListener("QuickActionsCommand.PageTransitions", this, this._onOpenPageTransitions);

            cmdmgr.registerCommandAndListener("WEditorSearch.RegisterProvider", this, this._registerProvider);
            cmdmgr.registerCommandAndListener("WEditorSearch.ReportRegisteredProviders", this, this._reportRegisteredProviders);
        },

        _searchHelpDialog: function(params) {
            var queryString = '';
            if(params && params.searchTag) {
                // TODO: URL Encode.
                queryString = '/help-categories?query=' + params.searchTag;
            }

            var helpServer = this.resources.W.Config.getHelpServerUrl();
            var helpCenter = helpServer + queryString;
            this.resources.W.EditorDialogs.openHelpDialog(helpCenter);
        },

        _onOpenSettingsSubPanel: function(label) {
            this.resources.W.Commands.executeCommand("WEditorCommands.Pages") ;
            this.resources.W.Commands.executeCommand("WEditorCommands.PageSettings", "settingsPanel") ;
            //this.resources.W.Commands.executeCommand("WEditorCommands.Settings") ;

//            var self = this;
//            var localizedLabel = this.resources.W.Resources.get('EDITOR_LANGUAGE', label) ;
//            this.resources.W.Commands.executeCommand("WEditorCommands.Settings", {callback: function(settingsPanel) {
//                var buttons = settingsPanel.$view.getElements('[comp*=WButton]');
//                if (!buttons.length) {
//                    setTimeout(self._onOpenSettingsSubPanel.bind(self, label), 100);
//                    return;
//                }
//                // Using setSelected as well since click doesn't always keep
//                // the selected button selected, probably due to rerendering
//                _.find(buttons, {textContent: localizedLabel}).click();
//                _.map(buttons, function(button) {button.$logic.setSelected(false)});
//                _.find(buttons, {textContent: localizedLabel}).$logic.setSelected(true);
//            }});
        },

        _onShowSiteName: function() {
            this._openSettingsTab();
            this.resources.W.Commands.executeCommand("WEditorCommands.ShowSiteName", null);
        },

        _onShowFaviconAndThumbnail: function() {
            this._openSettingsTab();
            this.resources.W.Commands.executeCommand("WEditorCommands.ShowFaviconAndThumbnail", null);
        },

        _onShowSocial: function() {
            this._openSettingsTab();
            this.resources.W.Commands.executeCommand("WEditorCommands.ShowSocial", null);
        },

        _onShowSeo: function() {
            this._openSettingsTab();
            this.resources.W.Commands.executeCommand("WEditorCommands.ShowSEO", null);
        },

        _onShowStatistics: function() {
            this._openSettingsTab();
            this.resources.W.Commands.executeCommand("WEditorCommands.ShowStatistics", null);
        },

        _openSettingsTab: function () {
            this.resources.W.Commands.executeCommand("WEditorCommands.Settings");
        },

//        _openMediaFrame: function () {
//            var self = this;
//            this.resources.W.Commands.executeCommand("WEditorCommands.OpenMediaFrame", {
//
//                callback: function (selectedImage) {
//                    var listener = {
//                        onSuccess: function (payload) {
//                            if (!payload.comp) {
//                                return;
//                            }
//                            self.resources.W.Commands.unregisterListener(listener);
//                            var image = payload.comp;
//                            var data = image.getRawData();
//                            data.height = selectedImage.height;
//                            data.width = selectedImage.width;
//                            data.uri = selectedImage.uri;
//                            data.title = selectedImage.title;
//                            image.getDataItem().setData(data);
//                        }
//                    };
//                    self.resources.W.Commands.registerCommandAndListener("WEditorCommands.SelectedComponentChange", listener, listener.onSuccess, null, true);
//                    W.CommandsNew.executeCommand("WEditorCommands.AddComponent", {compType: 'WPhoto', styleId: 'wp1'});
//
//                },
//                i18nPrefix: "multiple_images",
//                publicMediaFile: "photos",
//                selectionType: "single",
//                mediaType: 'picture'
//            });
//        },

        _deleteCurrentPage: function() {
            var pageId = this.resources.W.Preview.getPreviewManagers().Viewer.getCurrentPageId();
            if(!this.resources.W.Editor) {
                this.resources.W.Utils.callLater(this._deleteCurrentPage, arguments, this, 100);
            }
            this.resources.W.Editor.deletePage(this.resources.W.Preview.getPreviewManagers().Viewer.getPageData(pageId));
        },

        _openPageSettings: function() {
            var pageId = this.resources.W.Preview.getPreviewManagers().Viewer.getCurrentPageId();
            this.resources.W.Commands.executeCommand("page settings", pageId);
        },

        _openManageStore: function () {
            var eCommPart = this.resources.W.Preview.getElementBySelector('[comp=wixapps.integration.components.AppPart][partId=ecommerce_30b4a102-7649-47d9-a60b-bfd89dcca135]');
            if (null != eCommPart) {
                if(!this.resources.W.Editor) {
                    this.resources.W.Utils.callLater(this._openManageStore, arguments, this, 100);
                }
                this.resources.W.Editor.setSelectedComp(eCommPart.$logic);
                this.resources.W.Commands.executeCommand('WAppsEditorCommands.OpenEditDataDialog', {selectedComp: eCommPart.$logic});
            }
        },

        _openManageBlog: function() {
            var appInstance = this.resources.W.Preview.getPreviewManagers().Apps.getAppByPackageName('blog');
            var blogAppPart = _.find(appInstance.getAppParts(), {_partDef:{id:"4de5abc5-6da2-4f97-acc3-94bb74285072"}});
            this.resources.W.Commands.executeCommand('WAppsEditorCommands.OpenEditDataDialog', {selectedComp: blogAppPart});
        },

        _onOpenPageTransitions: function() {
            this.resources.W.Commands.executeCommand('WEditorCommands.Pages');

        },

        _registerProvider: function (provider) {
            var containsProvider = _.any(this._providers, function (registeredProvider) {
                return registeredProvider === provider;
            });

            if (!containsProvider) {
                if (!!this._providerRegistrationCallback) {
                    this._providerRegistrationCallback(provider);
                }
                this._providers.push(provider);
            }
        },

        _reportRegisteredProviders: function(callback) {
            _.each(this._providers, function(provider) {
                callback(provider);
            }, this);

            this._providerRegistrationCallback = callback;
        }
    });
});