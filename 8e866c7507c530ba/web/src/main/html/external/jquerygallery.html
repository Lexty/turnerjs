<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>

        <link rel="stylesheet" type="text/css" href="../tpa/jquerygallery/wowslider/style.css">

        <script src='//sslstatic.wix.com/services/js-sdk/1.17.0/js/Wix.js'></script>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>

        <script type="text/javascript" src="../tpa/jquerygallery/wowslider/wowslider.js"></script>

        <script>
            var _data;

            Wix.addEventListener(Wix.Events.SETTINGS_UPDATED, function(message) {
                $("body").empty();
                _data = message.items;

                // Code for WOWSlider gallery

                var galleryStr = '<div id="wowslider-container1">';
                galleryStr += createImagesList(_data);
                galleryStr += createBulletsList(_data);
                galleryStr += '</div>'; // wowslider-container1 div close

                $('body').append(galleryStr);

                var script = document.createElement('script');  // Adding the WOW Slider initiation script
                script.type = 'text/javascript';
                script.src = '../tpa/jquerygallery/wowslider/script.js';
                $("body").append(script);

            });

            function createImagesList(data) {
                var imagesStr = '<div class="ws_images"><ul>';
                for(var i = 0; i < _data.length; i++) {
                    var url = _data[i].url;
                    var image = getResizedImage(i, 650, 480);
                    imagesStr += '<li><img src=' + image + ' title="' + _data[i].title + '" id="wows1_' + i + '"></li>';
                }
                imagesStr += '</ul></div>';    // ws_images div close

                return imagesStr;
            }

            function createBulletsList(data) {
                var bulletsStr = '<div class="ws_bullets"><div>';
                for(var i = 0; i < _data.length; i++) {
                    var url = _data[i].url;
                    bulletsStr += '<a href="#" title="' + _data[i].title + '">' + i + '</a>';
                }
                bulletsStr += '</div>'; // ws_bullets div close

                return bulletsStr;
            }

            function getResizedImage(imageIndex, width, height) {
                var url = _data[imageIndex].url;
                return Wix.Utils.Media.getResizedImageUrl(url.substr(url.lastIndexOf("/")), width, height);
            }
        </script>
    </head>
    <body>
    </body>
</html>
