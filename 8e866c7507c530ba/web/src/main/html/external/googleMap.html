<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no"/>
    <style type="text/css">
        *{
            border: none;
            margin: 0;
            padding: 0;
        }

        html {
            height: 100%
        }

        body {
            height: 100%;
            margin: 0;
            padding: 0
        }

        #map_canvas {
            height: 100%;
            width: 100%;
        }
        .gm-style-iw p{
            width: 101%;
        }
    </style>
    <script type="text/javascript" src="//maps.googleapis.com/maps/api/js?key=AIzaSyCWeeateTaYGqsHhNcmoDfT7Us-vLDZVPs&sensor=true"></script>
    <script type="text/javascript">
        var crutches = function(){
            if (String && String.prototype && !String.prototype.trim) {
                String.prototype.trim = function () {
                    return this.replace(/^\s+|\s+$/gm, '');
                };
            }
        };

        function initialize () {
            crutches();

            var latlng = new google.maps.LatLng(40.73, -74);
            var myOptions = {
                'zoom': 14,
                'disableDefaultUI': true,
                'center': latlng,
                'mapTypeId': google.maps.MapTypeId.ROADMAP
            };
            myMap = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
            google.maps.event.addListenerOnce(myMap, 'idle', googleSpike); // spike for google maps known bug https://code.google.com/p/gmaps-api-issues/issues/detail?id=5713

            if (window.addEventListener){
                window.addEventListener('message', update, false);
            }
            else if (window.attachEvent){
                window.attachEvent('onmessage', update);
            }
        }

        function update (e) {
            var json = JSON.parse(e.data);

            var mapType = json["mapType"];
            var isMapInteractive = json["mapDragging"];
            var options /*MapOptions*/ = {
                'zoomControl': json["showZoom"],
                'panControl': json["showPosition"],
                'streetViewControl': json["showStreetView"],
                'mapTypeControl': json["showMapType"],
                'scaleControl': true,
                'draggable': isMapInteractive,
                'disableDefaultUI': !isMapInteractive,
                'disableDoubleClickZoom': !isMapInteractive,
                'scrollwheel': isMapInteractive
            };

            myMap.setOptions(options);
            if (mapType)
                myMap.setMapTypeId(google.maps.MapTypeId[mapType]);

            window.latLongObj = new google.maps.LatLng(json.latVal, json.longVal);
            var latLongObj = window.latLongObj;
            var address = json.address;

            if (latLongObj) {
                myMap.setCenter(latLongObj);
                if (!window._marker) {
                    window._marker = new google.maps.Marker();
                    window._marker.setMap(myMap);
                }

                window._marker.setPosition(latLongObj);
                var addressInfo = (json.addressInfo || '').trim().replace(/<\/?[^>]+>/g, " ");
                var address = (json.address || '').trim().replace(/<\/?[^>]+>/g, " ");

                if (!window._infoWindow) {
                    window._infoWindow = new google.maps.InfoWindow({
                        maxWidth: (window.innerWidth ? window.innerWidth : document.documentElement.clientWidth) * .7 // fix for autoPan bug
                    });

                    google.maps.event.addListener(window._marker, 'click', markerClick);

                    google.maps.event.addListener(window._infoWindow, 'closeclick', function(){
                        window._marker.setTitle("Click to see more...");
                        myMap.setCenter(window.latLongObj);
                    });
                }

                window._marker.setTitle("");

                //var p = document.createElement('p');
                //p.innerHTML = isInfoBlank ? json.address : addressInfo;
                window._infoWindow.setContent(addressInfo || address);

                if (!addressInfo){ // don't open when info is blank
                    window._marker.setTitle("Click to see more...");
                    window._infoWindow.close();
                } else{
                    markerClick();
                }
            } else if (window._marker) {
                window._marker.setMap(null); // remove marker
            }
        }

        function markerClick(){
            window._marker.setTitle("");
            window._infoWindow.open(myMap, window._marker);
        }

        function googleSpike(){ // spike for google maps known bug https://code.google.com/p/gmaps-api-issues/issues/detail?id=5713
            setTimeout(markerClick, 100);
        }
    </script>
</head>
<body onload="initialize()">
<div id="map_canvas"></div>
</body>
</html>