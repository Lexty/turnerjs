<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="x-ua-compatible" content="IE=edge">

    <style>
        html{
            height: 100%;
            overflow: hidden;
        }
        body{
            height: 100%;
            margin: 0;
            padding: 0;
        }

    </style>
</head>
<body>
    <a id="pin" class="pin" data-pin-do="embedPin" href=""></a>
       <script type="text/javascript">
           var self =this;
           var Controller = function(){
               var data = this._parseUrl();
               this._setData(data);
               var controllerScope= this;

               var eventMethod = window.addEventListener ? "addEventListener" : "attachEvent";
               var removeMethod =  window.removeEventListener ? "removeEventListener" : "detachEvent";

               var domInsertedFunc = function (e) {
                   var elem = document.getElementsByTagName("A");
                   controllerScope.removeProtocol(elem);
               }

               var resizeCallback = function (e) {
                   if (document.body.scrollHeight>0 &&document.body.scrollWidth>0){
                       self.parent.postMessage(JSON.stringify({"topic":"resize","height":document.body.scrollHeight,"width":document.body.scrollWidth,"id":data.id}),data.originDomain ? data.originDomain: "*");
                   }
               }

               var checkState = function (){
                   controllerScope.currTry++;
                   if (controllerScope.currTry>controllerScope.maxtries){
                       clearTimeout(controllerScope.intervalid);
                       var elem = document.getElementsByTagName("A");
                       if (elem.length == 1){
                           self.parent.postMessage(JSON.stringify({"topic":"emptyComp","id":data.id}),data.originDomain ? data.originDomain: "*");
                         }
                       document[removeMethod]("DOMSubtreeModified",resizeCallback);
                       document[removeMethod]("DOMNodeInserted",domInsertedFunc);
                   }else{
                        if (controllerScope.isIE () && document.body.scrollHeight>0 &&document.body.scrollWidth>0){
                            var elem = document.getElementsByTagName("A");
                            controllerScope.removeProtocol(elem);
                             if (controllerScope.isIE () <9){
                                self.parent.postMessage(JSON.stringify({"topic":"resize","height":document.body.scrollHeight,"width":document.body.scrollWidth,"id":data.id}),data.originDomain ? data.originDomain: "*");
                            }

                        }
                   }
               }

               document[eventMethod]("DOMNodeInserted", domInsertedFunc);

               document[eventMethod]("DOMSubtreeModified", resizeCallback , false);

               this.intervalid = setInterval(checkState, 1000);
               if (controllerScope.isIE () && controllerScope.isIE () < 9){
                   self.parent.postMessage(JSON.stringify({"topic":"resize","height":0,"width":0,"id":data.id}),data.originDomain ? data.originDomain: "*");
               }
           };

           Controller.prototype = {
               maxtries: 5,
               currTry : 0,
               intervalid:"",
               _getEl: function(){
                   this.el = document.getElementById('pin');
                   return this.el;
               },
               isIE :function() {
                   var myNav = navigator.userAgent.toLowerCase();
                   return (myNav.indexOf('msie') != -1) ? parseInt(myNav.split('msie')[1]) : false;
               },
               removeProtocol : function (elem){
                    for (var i=0; i< elem.length; i++){
                        var aTag = elem[i];
                        var url = aTag.href;
                        if (url != undefined) {
                            if (url.indexOf('http://') === 0) {
                                url = url.substr(5);
                            }
                            if (url.indexOf('https://') === 0) {
                                url = url.substr(6);
                            }
                            var index = url.indexOf('//www.pinterest');
                            if (index > 0) {
                                url = url.substr(index);
                            }
                        }
                    }
                   aTag.href = url;
               },
               _parseUrl: function(){
                   var query = location.search.substring(1),
                           queryPairs = query.split('&'),
                           queryPair,
                           i,
                           params = {};

                   for (i = 0; i < queryPairs.length; i++){
                       queryPair = queryPairs[i].split('=');
                       params[decodeURIComponent(queryPair[0])] = decodeURIComponent(queryPair[1]);
                   }

                   return params;
               },

               _setData: function(data){
                   var el = this._getEl()
                   el.href =  data.pinUrl;
               }
           };
           var controller = new Controller();

       </script>
    <script type="text/javascript" async src="//assets.pinterest.com/js/pinit.js"></script>
</body>

</html>