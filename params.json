{
  "name": "Turnerjs",
  "tagline": "Created by carmelc",
  "body": "# Angular Components Test Kit\r\n\r\n## Talk\r\nCan be downloaded via [Slideshare](https://u5283.ct.sendgrid.net/wf/click?upn=uO6HrIECmgsMyMFzOPMkJYGYLADpdUHdfI6J1dVtgwnTWzZ1-2B1a5bySNoLYlu9QIldML-2FPycLoyx-2FRfHUroVVRKQI0G-2BB7wD2GmagU-2F-2BaFO1GcQKZqTrLfcvI0-2Feq88U4MDDbWxKTMQq15nEkNaTrkhZIEN-2BIjBAqqg35v-2BUjy2Twh3o7-2F-2BMoBQuxY83o7cP_-2F0-2FOxt-2FTDNjPdgoVegGf3gWbc1x6lNE40K0OYIqiiEvA6QswJ-2BwAuEpEMZUWwF9pCCtXpZHa-2Blt19xDW8YLhwNH0buvisU141e9DwO8i-2FtHG4W1yIqIwmvtfz6eqxMt-2FKGTTQY4eR-2F43Sq5XMM2Dcv8czg-2FptYVNvd7fSa-2Fk1ulilJE5DRaYf8AWqy7gUQ2GQKrYehzRQiMwRXFmhxUPi9p5elNaeRifJJbzOrwyHJCJE85erCOU9BC6cqRFonXG-2FgLI0fQq9IJA61i4Z8AJDcRFZrLP3ZQqfF2Xvf-2FiSZ1jKPBpFVsd9RO-2FsqBDo6BeXrm5zSCKTDfxsL0cHIUqkcH4jesDUnfJR67EoqU8SyJo0NnGZlbOM04OaAwKTZDw)\r\n**Note** - please download in order to be able to utilize the animations included in the deck.\r\n\r\n## Overview\r\nComponent tests allows testing the UI (provided that it is build as components/directives of course) in order to get instant feedback and minimize the use of protractor.\r\n\r\nThe test kit provides a base driver utility class - **TurnerComponentDriver**, which allows writing tests using typescript in order to test components in a more readable, maintainable and quicker manner,\r\nIt provides basic methods to allow rendering a template, accessing underlying elements and ability to maintain drivers' hierarchy, in order to be able to reuse drivers in parent components.\r\n\r\nThe best practice implemented by TurnerJS in regards to elements' selectors is by using a 'data-hook' attribute in order to mark elements which are accessed by your code.\r\nIt implements the approach demonstrates in [this](http://html5doctor.com/html5-custom-data-attributes/) article, but it is not mandated by the framework, one can use any other data selectors approach.\r\n\r\n## Installation - Bower\r\n1. install using bower  \r\n`bower install --save turnerjs`\r\n2. Include the following reference in your Karma configuration file  \r\n`'<path to your app>/bower_components/turnerjs/dist/test/lib/turnerjs-driver.js'`\r\n3. *Optional* - if you are using TypeScript (recommended) add reference to the d.ts file in your tsconfig file:  \r\n`\"bower_components/turnerjs/dist/test/lib/turnerjs-driver.d.ts\"`\r\n\r\n## Installation - NPM\r\n1. install using node package manager  \r\n`npm install -S turnerjs`\r\n2. Include the following reference in your Karma configuration file  \r\n`'node_modules/turnerjs/module/generated/turnerjs-driver.js'` \r\n   or   \r\n`require(turnerjs)` (when window is supported)\r\n3. *Optional* - if you are using TypeScript (recommended) add reference to the d.ts file in your tsconfig file:  \r\n`\"../node_modules/turnerjs/module/generated/turnerjs-driver.d.ts\"`\r\n\r\n## Usage\r\n* Create a driver that extends the base driver and implement the methods that are required for your tests, for example (in the spec file or elsewhere):\r\n\r\n```javascript\r\n   class ExampleComponentDriver extends TurnerComponentDriver {\r\n           \r\n        constructor() {\r\n          super();\r\n        }\r\n      \r\n        render(param1, param2) {\r\n          //renders the template and adds the input parameters as scope params (second argument to renderFromTemplate method)\r\n          //passing a selector is needed when the element containing the directive is not the first element in the template or when there is more than one driver\r\n          this.renderFromTemplate('<example-component another-attribute=\"param2\"><div data-hook=\"inner-element\">{{param1}}</div></example-component>', {param1, param2}, 'example-component');\r\n        }\r\n      \r\n        isInnerElementValid(): boolean {\r\n           return this.findByDataHook('inner-element').text() === 'valid';\r\n        }\r\n      }\r\n```\r\n\r\n* Write tests that utilizes the driver\r\n\r\n```javascript\r\n    let driver: ExampleComponentDriver;\r\n    beforeEach(() => {\r\n       driver = new ExampleComponentDriver();\r\n       driver.render('valid', 'yada yada');\r\n       driver.connectToBody();\r\n    });\r\n   \r\n    afterEach(() => {\r\n        driver.disconnectFromBody();\r\n    });\r\n    \r\n    it('should contain a valid element value', () => {\r\n        expect(driver.isInnerElementValid()).toBeTruthy();\r\n    });\r\n```\r\n\r\n## Global Methods added by the test kit\r\n|Param|Type|Arguments|Details|\r\n|---|---|---|---|\r\n|byDataHook|global method|dataHook: string|Create a data-hook selector it is useful for methods that uses selectors such as ***TurnerComponentDriver.defineChild***|\r\n\r\n## Base Driver Methods/ Members\r\n|Param|Type|Arguments|Details|\r\n|---|---|---|---|\r\n|constructor|Constructor|N/A|Creates the driver|\r\n|renderFromTemplate|protected method|**template**: string, **args**?: Object, **selector**?: string|Allows rendering the component/directive, the args is a key value pairs object that will be added to the scope of the element, initializes the root of the driver according to the selector |\r\n|findByDataHook|protected method|**dataHook**: string|a utility method that should be used by drivers that inherits from the base driver in order to select an element (first if there are several) by **data-hook** attribute. It will throws an error if called before ***renderFromTemplate*** was called|\r\n|findAllByDataHook|protected method|**dataHook**: string|similar to ***findByDataHook*** but allows selecting several elements with the same **data-hook**|\r\n|defineChild|protected method|**childDriver**: Instance of T such that T extends **TurnerComponentDriver**, **selector**: string representing a CSS selector (preferably called with ***byDataHook(dataHook)***)|Declare a child driver of the current driver, allows components hierarchy, which is also returned by the method. This method should be called before ***renderFromTemplate*** was called|\r\n|defineChildren|protected method|**factory**: function that returns an instance of T such that T extends **TurnerComponentDriver**, **selector**: string representing a CSS selector (which is expected to return more than one result)|returns an array of child drivers (instances of T), it is useful when there is more than one child driver for parent driver (e.g. ng-repeat), the returned array will change when there is a change in the number of elements in the dom. This method should be called before ***renderFromTemplate*** was called|\r\n|applyChanges|public method|N/A|invokes $rootScope.$digest(), mainly aimed to 'hide' *AngularJS* related implementation|\r\n|connectToBody|public method|N/A|Connects the template to the karma's browser body - allows height/width related tests. ***disconnectFromBody*** has to be called at the end of the test. It will thorw an error if called before ***renderFromTemplate*** was called|\r\n|disconnectFromBody|public method|N/A|Clears the the body of the karma's browser, used in order to reset the browser to the original state prior to starting the next test|\r\n|afterRender|protected method|N/A|You can override this method if you need extra setup after render|\r\n|element|ng.IAugmentedJQuery|N/A|Reference to the element that represents the root of the driver (by selector if provided or template root)|\r\n|scope|ng.IScope|N/A|Reference to the scope of ***element*** member|\r\n|isRendered|boolean|N/A|defines whether the driver is rendered - whether its template was rendered and its scope is valid (defined and part of the dom)|\r\n|appendedToBody|boolean|N/A|defines whether the driver's element is appended to body (e.g. a driver for bootstrap tooltip)|\r\n|$rootScope|ng.IRootScopeService|N/A|Reference to the **$rootScope** service (removes the need to inject it in tests)|\r\n\r\n## Nested drivers\r\nIn order to allow reuse of drivers, the base driver supports initializing any child element (member) that extends **TurnerComponentDriver**\r\nFor example, assuming 3 components are defined:\r\n```javascript\r\n   angular.module('myModule', []);\r\n   class ItemComponentCtrl {\r\n     public item: {value: number};\r\n\r\n     isValid():  boolean {\r\n       return this.item.value > 1;\r\n     }\r\n   }\r\n   \r\n   angular\r\n     .module('myModule')\r\n     .component('itemComponent', {\r\n       template: `<div data-hook=\"item-element\" ng-class=\"{'valid': $ctrl.isValid()}\"/>`,\r\n       controller: ItemComponentCtrl,\r\n       bindings: {\r\n         item: '='\r\n       }\r\n     });\r\n   \r\n   class IndividualComponentCtrl {\r\n     public item: {value: number};\r\n\r\n     getText():  string {\r\n       return this.item.value > 1 ? 'valid' : 'invalid';\r\n     }\r\n   }\r\n   \r\n   angular\r\n     .module('myModule')\r\n     .component('individualComponent', {\r\n       template: `<div data-hook=\"inner-element\">{{$ctrl.getText()}}</div>`,\r\n       controller: IndividualComponentCtrl,\r\n       bindings: {\r\n         item: '='\r\n       }\r\n     });\r\n   \r\n   class ParentComponentCtrl {\r\n     public items: {value: number}[];\r\n   \r\n     constructor() {\r\n       this.items = [];\r\n       for (let i = 0; i < 5; i++) {\r\n         //push either 1 or 2\r\n         this.items.push({\r\n           value: Math.floor((Math.random() * 2) + 1)\r\n         });\r\n       }\r\n     }\r\n   }\r\n   \r\n   angular\r\n     .module('myModule')\r\n     .component('parentComponent', {\r\n       template: `<div>\r\n                    <individual-component item=\"$ctrl.items[0]\"/>\r\n                    <item-component ng-repeat=\"item in $ctrl.items\" item=\"item\"/>\r\n                  </div>`,\r\n       controller: ParentComponentCtrl\r\n     });\r\n\r\n```\r\n\r\n3 Drivers that corresponds to each are defined:  \r\n(When there is a list of child drivers - e.g. when using ng-repeat, **defineChildren** method should be used in order to declare an array of child drivers)\r\n```javascript\r\n  \r\nclass IndividualComponentDriver extends TurnerComponentDriver {\r\n\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  render(item) {\r\n    this.renderFromTemplate('<individual-component item=\"item\"/>', {item});\r\n  }\r\n\r\n  isValid(): boolean {\r\n    return this.findByDataHook('inner-element').text() === 'valid';\r\n  }\r\n}\r\n\r\nclass ItemComponentDriver extends TurnerComponentDriver {\r\n\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  render(item) {\r\n    this.renderFromTemplate('<item-component item=\"item\"/>', {item}, 'item-component');\r\n  }\r\n\r\n  isValid(): boolean {\r\n    return this.findByDataHook('item-element').hasClass('valid');\r\n  }\r\n}\r\n\r\nclass ParentComponentDriver extends TurnerComponentDriver {\r\n  public innerComponent: IndividualComponentDriver;\r\n  public itemComponents: ItemComponentDriver[];\r\n\r\n  constructor() {\r\n    super();\r\n    this.innerComponent = this.defineChild(new IndividualComponentDriver(), 'individual-component');\r\n    this.itemComponents = this.defineChildren(() => new ItemComponentDriver(), 'item-component');\r\n  }\r\n\r\n  render() {\r\n    this.renderFromTemplate(`<parent-component>`);\r\n  }\r\n\r\n  isIndividualValid(): boolean {\r\n    return this.innerComponent.isValid();\r\n  }\r\n\r\n  isItemsValid(): boolean {\r\n    let result = true;\r\n    this.itemComponents.forEach(itemDriver => {\r\n      result = result && itemDriver.isValid();\r\n    });\r\n    return result;\r\n  }\r\n}\r\n```\r\n**TurnerComponentDriver** will initialize the member's scope & element automatically as soon as the renderFromTemplate method is invoked.\r\nThe above drivers will allow testing each component separately and also testing the parent component that wraps the two:\r\n```javascript\r\ndescribe('Usage Examples when there are repeatable drivers', () => {\r\n    let parentComponentDriver: ParentComponentDriver;\r\n    beforeEach(() => {\r\n      module('myModule');\r\n      parentComponentDriver = new ParentComponentDriver();\r\n    });\r\n\r\n    it('should be valid when the random values are above 1', () => {\r\n      spyOn(Math, 'random').and.returnValue(0.9);\r\n      parentComponentDriver.render();\r\n      expect(parentComponentDriver.isIndividualValid()).toBe(true);\r\n      expect(parentComponentDriver.isItemsValid()).toBe(true);\r\n    });\r\n  });\r\n```\r\n## Non TypeScript usage\r\nThough the recommendation is to use TypeScript with turnerjs, if you are not using it, you can create the driver using prototypical inheritance.\r\nThere are various ways to implement it, but the test kits includes a test spec for ES5 usage (see ***app/test/spec/components/es5-name-formatter.js***)\r\nThe below provides the basic implementation of such driver:\r\n```javascript\r\n/* globals TurnerComponentDriver */ //for jshint\r\nfunction ES5Driver() {\r\n  TurnerComponentDriver.call(arguments);\r\n}\r\n\r\nES5Driver.prototype = new TurnerComponentDriver();\r\nES5Driver.constructor = ES5Driver;\r\n\r\nES5Driver.prototype.render = function () {\r\n  this.renderFromTemplate('<es5-component-template></es5-component-template>');  \r\n};\r\n//other driver methods\r\n\r\ndescribe('your tests are here', function () {\r\n    var es5driver;\r\n    \r\n    beforeEach(function () {\r\n        angular.mock.module('turnerjsAppInternal');\r\n        driver = new ES5Driver();\r\n    });\r\n    \r\n    it('...', function () {\r\n        driver.render();\r\n        //test e\r\n    });\r\n});\r\n```\r\n#### Contribution\r\nVia pull requests,  \r\n    \r\nAfter cloning the repository please run `npm install` and `bower install` in order to fetch dependencies   \r\n  \r\nRunning/Building the project is done by using ***grunt***:  \r\n`grunt serve:clean` - will start the server, there is no real UI for it, but it will run the unit tests on each save\r\n`grunt build` - build the project to make sure that changes are valid and meeting all code style definitions\r\n\r\n#### Credits\r\nAlon Yehezkel  \r\nShahar Talmi  \r\nBoris Litvinski  \r\nAmit Shvil  \r\n\r\n## License\r\n\r\nThe MIT License.\r\n\r\nSee [LICENSE](LICENSE.md)\r\n",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}